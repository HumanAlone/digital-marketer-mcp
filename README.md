# MCP Сервер: Яндекс.Директ Монитор

## Описание
MCP (Model Context Protocol) сервер для анализа и мониторинга рекламных кампаний Яндекс.Директ. Сервер предоставляет набор инструментов для получения аналитики, оценки эффективности и генерации рекомендаций по оптимизации рекламных кампаний.

## Назначение
Сервер выступает в качестве промежуточного слоя между AI-агентом и данными Яндекс.Директ, предоставляя структурированные инструменты для:
- Сбора и анализа метрик эффективности кампаний
- Оценки соответствия бизнес-целям (CPA, бюджет)
- Генерации рекомендаций по оптимизации
- Планирования рекламных сценариев

## Архитектура

### Технологический стек
- **Framework**: FastMCP (Model Context Protocol)
- **Транспорт**: Streamable HTTP (stateless)
- **Язык**: Python 3.13+
- **Формат данных**: JSON-RPC 2.0
- **Аутентификация**: Bearer Token для Яндекс.Директ API

### Структура проекта
```
digital-marketer-mcp/  
├── server.py                   # Главный файл запуска сервера  
├── mcp_instance.py             # Единый экземпляр FastMCP  
├── requirements.txt            # Зависимости Python  
├── .env.example                # Пример переменных окружения  
└── tools/                      # Каталог инструментов MCP  
    ├── __init__.py             # Инициализация модуля инструментов  
    ├── campaign_performance.py # Получение данных по кампании  
    ├── campaign_health.py      # Анализ здоровья кампании  
    ├── daily_report.py         # Генерация сводных отчетов  
    ├── scenarios.py            # Расчет сценариев бюджета  
    ├── cpa_calculator.py       # Калькулятор CPA  
    └── connection_test.py      # Проверка подключения  
```

## Доступные инструменты

### 1. `get_campaign_performance`
Получает и анализирует отчет по эффективности рекламной кампании.

**Параметры:**
- `campaign_id` (str): Уникальный идентификатор кампании
- `days` (int, optional): Период анализа в днях (по умолчанию 7)

**Возвращает:**
- Ключевые метрики: расходы, конверсии, клики, показы
- Расчетные показатели: CPA, CTR, CPC
- Тренд данных: improving/stable/worsening

**Пример использования:**
```python
# Получить данные за 7 дней
result = get_campaign_performance("123456789", days=7)

# Получить данные за 30 дней  
result = get_campaign_performance("123456789", days=30)
```

### 2. `analyze_campaign_health`
Анализирует здоровье кампании по бизнес-правилам и целевым показателям.

**Параметры:**

- `campaign_id` (str): Идентификатор кампании
- `target_cpa` (float): Целевая стоимость конверсии (руб.)
- `daily_budget_limit` (float): Лимит дневного бюджета (руб.)

**Возвращает:**

- Оценку здоровья (0-100)
- Статус: healthy/needs_attention/critical
- Выявленные проблемы и рекомендации
- Предупреждения и требуемые действия

**Бизнес-правила:**

- CPA критический: Фактический CPA > Целевой CPA × 1.5
- CPA высокий: Фактический CPA > Целевой CPA × 1.2
- Перерасход бюджета: Средний дневной расход > Лимит бюджета
- Нет конверсий: Кликов > 50 и Конверсий = 0

### 3. `generate_daily_report`
Генерирует сводный ежедневный отчет по нескольким кампаниям.

**Параметры:**

- `campaign_ids` (List[str]): Список идентификаторов кампаний

**Возвращает:**

- Структурированный отчет в формате Markdown
- Сводную статистику по всем кампаниям
- Приоритетные задачи для менеджера
- Критические проблемы требующие внимания

### 4. `calculate_scenarios`
Рассчитывает финансовые сценарии для достижения целевых конверсий.

**Параметры:**

- `campaign_id` (str): Идентификатор кампании
- `target_conversions` (int): Желаемое количество конверсий

**Возвращает:**

- Три сценария с разными стратегиями
- Расчетный бюджет для каждого сценария
- Рекомендации по выбору стратегии

### 5. `calculate_cpa`
Рассчитывает стоимость привлечения клиента (CPA) на основе расходов и конверсий.

**Параметры:**

- `cost` (float): Общие расходы (руб.)
- `conversions` (int): Количество конверсий

**Возвращает:**

- Рассчитанное значение CPA
- Оценку эффективности
- Рекомендации по оптимизации

### 6. `test_connection`
Проверяет работоспособность MCP сервера и доступность инструментов.

**Параметры:** Нет

**Возвращает:**

- Статус сервера и доступных инструментов
- Информацию о конфигурации

## Настройка и запуск
1. Установка зависимостей

```bash
pip install -r requirements.txt
```
2. Настройка переменных окружения
Создайте файл .env на основе .env.example:

```env
# Обязательные для реального использования
YANDEX_API_TOKEN=your_yandex_direct_token
YANDEX_API_URL=https://api.direct.yandex.com/json/v501/reports

# Опциональные
HOST=0.0.0.0
PORT=8000
LOG_LEVEL=INFO
```

3. Запуск сервера
```bash
python server.py
```
Сервер будет доступен по адресу: http://localhost:8000/mcp